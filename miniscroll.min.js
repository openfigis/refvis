/*!
 * Miniscroll small plugin of scrollbar desktop and mobile
 *
 * @author Roger Luiz <http://rogerluizm.com.br/>
 *					  <http://miniscroll.rogerluizm.com.br>
 *
 * @copyright (c) 2011, 2012 <http://rogerluizm.com.br/>
 *
 * @version 1.2.9
 *		update 1.2.9 | 10/09/2013 - fix multidimensional scrollwheel
 *		update 1.2.9 | 10/09/2013 - fix error in the scroll when the position is relative or absolute
 *		update 1.2.9 | 10/09/2013 - fix updating on the x axis
 *		update 1.2.8 | 03/09/2013 - add turn off mousewheel, ex: { mousewheel: true }
 *		update 1.2.7 | 03/09/2013 - add scrollTo, now its posible scroll to a custom position
 *		update 1.2.6 | 21/06/2013 - fix bug the whole scrollbar (not just the handler part) moves down when I drag it.
 *		update 1.2.5 | 18/05/2013 - fix bug thumb position with arrow keys
 * 		update 1.2.4 | 18/05/2013 - fix error it's time to catching the width and height
 * 		update 1.2.3 | 18/05/2013 - fix scrollbar position "x"
 * 		update 1.2.2 | 17/05/2013 - Key event added, now you can press the key down and key up for scrolling
 * 		update 1.2.1 | 15/05/2013 - Touch event added, now works for ipad, iphone and android
 */
!function(a,b,c){var d={touchEvents:"ontouchstart"in b.documentElement},e=function(a,b){this.type="",this.is="static",this.target=this.getElement(a),this.container,this.tracker,this.thumb,this.thumb_delta=f(0,0),this.thumb_pos=f(0,0),this.touch=f(0,0),this.settings=b,this.percent,this.keypos_thumb=f(0,0),this.scrolling=!1,this.preventScrolling=!1,this.turnOffWheel=!0,this.initializing()},f=function(a,b){return this instanceof f?(this.x=a?a:0,this.y=b?b:0,this):new f(a,b)};e[c].initializing=function(){this.buildScrollbar(),this.buildScrollbarTracker(),this.buildScrolbarThumb(),this.settings.isKeyEvent="undefined"==typeof this.settings.isKeyEvent?!0:this.settings.isKeyEvent,this.turnOffWheel="undefined"==typeof this.settings.turnOffWheel?this.turnOffWheel:this.settings.turnOffWheel,this.settings.isKeyEvent&&this.addKeyBoardEvent(),d.touchEvents?this.setupTouchEvent():this.setupEventHandler();var b=this;a.setInterval(function(){b.update()},10)},e[c].buildScrollbar=function(){var a=this.target.id?this.target.id:this.target.className;this.container=this.create(this.target,"div",{"class":"miniscroll-container",id:"miniscroll-"+a});var b=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height,c=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width,d=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size),e=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{position:"absolute",visibility:"hidden",width:("x"===this.settings.axis?c:this.settings.size)+"px",height:("y"===this.settings.axis?b:this.settings.size)+"px",top:("y"===this.settings.axis?this.offset(this.target).top:e)+"px",left:("x"===this.settings.axis?this.offset(this.target).left:d)+"px",zIndex:999})},e[c].buildScrollbarTracker=function(){this.tracker=this.create(this.container,"div",{"class":"miniscroll-tracker"});var a="x"===this.settings.axis?this.offset(this.container).width:this.settings.size,b="y"===this.settings.axis?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:a+"px",height:b+"px",backgroundColor:this.settings.trackerColor?this.settings.trackerColor:"#067f41"})},e[c].buildScrolbarThumb=function(){this.thumb=this.create(this.container,"div",{"class":"miniscroll-thumb"});var a=f(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),a=f(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),b=f(void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?a.x:this.settings.sizethumb,void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?a.y:this.settings.sizethumb);this.css(this.thumb,{position:"absolute",top:"0px",left:"0px",width:("x"===this.settings.axis?b.x:this.settings.size)+"px",height:("y"===this.settings.axis?b.y:this.settings.size)+"px",backgroundColor:this.settings.thumbColor?this.settings.thumbColor:"#2AD47D"})},e[c].setupEventHandler=function(){this.bind(this.thumb,"mousedown",this.onScrollThumbPress),this.bind(this.tracker,"mousedown",this.onScrollTrackerPress),this.turnOffWheel&&this.bind(this.target,"mousewheel",this.onScrollThumbWheel)},e[c].setupTouchEvent=function(){this.bind(this.target,"touchstart",this.onScrollTouchStart),this.bind(this.target,"touchmove",this.onScrollTouchMove)},e[c].updateContainerPosition=function(){this.is=this.getCss(this.target,"position"),"relative"===this.is||"absolute"===this.is?"y"===this.settings.axis?(this.container.style.top=this.target.scrollTop+"px",this.container.style.left=this.offset(this.target).width-this.settings.size+"px"):(this.container.style.top=this.offset(this.target).height-this.settings.size+"px",this.container.style.left=this.target.scrollLeft+"px"):"y"===this.settings.axis?this.container.style.top=this.offset(this.target).top+"px":this.container.style.left=this.offset(this.target).left+"px"},e[c].setScrubPosition=function(a){var b=this.offset(this.container).width,c=this.offset(this.container).height,d=this.offset(this.thumb).width,e=this.offset(this.thumb).height;this.thumb_pos=f(Math.round((b-d)*a),Math.round((c-e)*a)),"y"===this.settings.axis?this.thumb.style.top=Math.round(this.thumb_pos.y)+"px":this.thumb.style.left=Math.round(this.thumb_pos.x)+"px"},e[c].addKeyBoardEvent=function(){this.target.setAttribute("tabindex","-1"),this.css(this.target,{outline:"none"}),this.bind(this.target,"focus",function(a,c){!("onkeydown"in c)&&"onkeydown"in b&&(c=b),this.bind(c,"keydown",function(a){if(a.target==this.target){var e,b=a.keyCode||a.which,c={left:37,up:38,right:39,down:40},d=!0;switch(b){case c.up:0!==this.percent&&(this.keypos_thumb.y-=10);break;case c.down:1!==this.percent&&(this.keypos_thumb.y+=10);break;case c.left:0!==this.percent&&(this.keypos_thumb.x-=10);break;case c.right:1!==this.percent&&(this.keypos_thumb.x+=10);break;default:d=!1}"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=this.keypos_thumb.y,e=[38,40]):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=this.keypos_thumb.x,e=[37,39]),this.preventScrolling=this.percent>=1&&b==e[1]||this.percent<=0&&b==e[0]?!0:!1,!this.preventScrolling&&d&&this.stopEvent(a),this.updateContainerPosition()}})}),this.bind(this.target,"click",function(a,c){if(a.target==this.target){try{b.activeElement=c}catch(d){}c.focus()}})},e[c].onScrollTouchStart=function(a){var b=a.touches[0];this.scrolling=!0,this.touch=f(b.pageX,b.pageY),this.bind(this.target,"touchend",this.onScrollTouchEnd)},e[c].onScrollTouchMove=function(a){var b=a.touches[0];a.preventDefault();var c=f(this.touch.x-b.pageX,this.touch.y-b.pageY);this.touch=f(b.pageX,b.pageY),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=this.target.scrollTop+c.y):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=this.target.scrollLeft+c.x),this.updateContainerPosition()},e[c].onScrollTouchEnd=function(){this.scrolling=!1,this.unbind(this.target,"touchend",this.onScrollTouchEnd)},e[c].onScrollThumbPress=function(c){c=c?c:a.event,this.stopEvent(c),this.scrolling=!0,this.thumb_delta=f(this.thumb_pos.x-this.mouse(c).x,this.thumb_pos.y-this.mouse(c).y),this.bind(b,"mousemove",this.onScrollThumbUpdate),this.bind(b,"mouseup",this.onScrollThumbRelease),this.updateContainerPosition()},e[c].onScrollThumbUpdate=function(b){return b=b?b:a.event,this.stopEvent(b),this.scrolling?(this.thumb_pos=f(this.mouse(b).x+this.thumb_delta.x,this.mouse(b).y+this.thumb_delta.y),this.thumb_pos=f(Math.max(0,Math.min(this.container.offsetWidth-this.thumb.offsetWidth,this.thumb_pos.x)),Math.max(0,Math.min(this.container.offsetHeight-this.thumb.offsetHeight,this.thumb_pos.y))),this.percent=f(this.thumb_pos.x/(this.container.offsetWidth-this.thumb.offsetWidth),this.thumb_pos.y/(this.container.offsetHeight-this.thumb.offsetHeight)),this.percent=f(Math.max(0,Math.min(1,this.percent.x)),Math.max(0,Math.min(1,this.percent.y))),"y"===this.settings.axis?(this.thumb.style.top=Math.round(this.thumb_pos.y)+"px",this.target.scrollTop=Math.round((this.target.scrollHeight-this.target.offsetHeight)*this.percent.y)):(this.thumb.style.left=Math.round(this.thumb_pos.x)+"px",this.target.scrollLeft=Math.round((this.target.scrollWidth-this.target.offsetWidth)*this.percent.x)),this.keypos_thumb=f(this.target.scrollLeft,this.target.scrollTop),this.updateContainerPosition(),void 0):!1},e[c].onScrollThumbWheel=function(c){c=c?c:a.event;var k,d=c||a.event,g=([].slice.call(arguments,1),0),i=0,j=0;if(d.wheelDelta&&(g=d.wheelDelta/120),d.detail&&(g=-d.detail/3),j=g,i=g,d.deltaMode&&(j=-d.deltaY/3,i=-d.deltaX/3),void 0!==d.axis&&d.axis===d.HORIZONTAL_AXIS&&(j=0,i=-1*g),void 0!==d.wheelDeltaY&&(j=d.wheelDeltaY/120),void 0!==d.wheelDeltaX&&(i=-1*d.wheelDeltaX/120),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=Math.round(this.target.scrollTop-10*j),k=j):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=Math.round(this.target.scrollLeft-10*i),k=i),this.preventScrolling=this.percent>=1&&0>k||this.percent<=0&&k>0||0==k?!0:!1,this.preventScrolling||this.stopEvent(c),this.keypos_thumb=f(this.target.scrollLeft,this.target.scrollTop),b.createEvent){var l=b.createEvent("HTMLEvents");l.initEvent("scroll",!0,!1),this.target.dispatchEvent(l)}else{var l=b.createEventObject();this.target.fireEvent("onscroll",l)}this.updateContainerPosition()},e[c].onScrollThumbRelease=function(c){c=c?c:a.event,this.stopEvent(c),this.scrolling=!1,this.unbind(b,"mousemove",this.onScrollThumbUpdate),this.unbind(b,"mouseup",this.onScrollThumbRelease)},e[c].onScrollTrackerPress=function(a){var b=this.mouse(a).y-this.offset(this.container).top;this.scrolling=!0,this.scrollTo(b)},e[c].scrollTo=function(a){var b=Math.max(0,Math.min(this.offset(this.target).height-this.offset(this.thumb).height,a));"y"===this.settings.axis&&(this.thumb_pos.y=b,this.thumb.style.top=Math.round(this.thumb_pos.y)+"px",this.target.scrollTop=b,this.scrolling=!1)},e[c].update=function(){"y"===this.settings.axis?this.target.scrollHeight===this.offset(this.target).height?this.css(this.container,{visibility:"hidden"}):this.css(this.container,{visibility:"visible"}):this.target.scrollWidth===this.offset(this.target).width?this.css(this.container,{visibility:"hidden"}):this.css(this.container,{visibility:"visible"});var a=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height,b=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width,c=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size),d=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{width:("x"===this.settings.axis?b:this.settings.size)+"px",height:("y"===this.settings.axis?a:this.settings.size)+"px",top:("y"===this.settings.axis?this.offset(this.target).top:d)+"px",left:("x"===this.settings.axis?this.offset(this.target).left:c)+"px"});var e="x"===this.settings.axis?this.offset(this.container).width:this.settings.size,g="y"===this.settings.axis?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:e+"px",height:g+"px"});var h=f(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),i=f(void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?h.x:this.settings.sizethumb,void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?h.y:this.settings.sizethumb);this.css(this.thumb,{width:("x"===this.settings.axis?i.x:this.settings.size)+"px",height:("y"===this.settings.axis?i.y:this.settings.size)+"px"}),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.scrolling||this.setScrubPosition(this.percent)):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.scrolling||this.setScrubPosition(this.percent)),this.updateContainerPosition()},e[c].getElement=function(c){var d;if(c===a||c===b||"body"===c||"body, html"===c)return b.body;if("string"==typeof c||c instanceof String){var d,f=c.replace(/^\s+/,"").replace(/\s+$/,"");if(f.indexOf("#")>-1){this.type="id";var g=f.split("#");d=b.getElementById(g[1])}if(f.indexOf(".")>-1){this.type="class";for(var g=f.split("."),h=b.getElementsByTagName("*"),i=h.length,l=0;i>l;l++)h[l].className&&h[l].className.match(new RegExp("(^|\\s)"+g[1]+"(\\s|$)"))&&(d=h[l])}return d}return c},e[c].create=function(a,c,d){var e=b.createElement(c);if(d){for(var f in d)d.hasOwnProperty(f)&&e.setAttribute(f,d[f]);a.appendChild(e)}return e},e[c].css=function(a,b){for(var c in b)"opacity"===c?(a.style.filter="alpha(opacity="+100*b[c]+")",a.style.KhtmlOpacity=b[c],a.style.MozOpacity=b[c],a.style.opacity=b[c]):a.style[c]=b[c]},e[c].getCss=function(c,d){var e;return e=a.getComputedStyle?a.getComputedStyle(c).getPropertyValue(d):b.defaultView&&b.defaultView.getComputedStyle?b.defaultView.getComputedStyle.getPropertyValue(d):c.currentStyle?c.currentStyle[d]:c.style[d]},e[c].offset=function(a){var b=a.offsetTop,c=a.offsetLeft,d=a.offsetHeight;"undefined"==typeof a.offsetHeight&&(d=parseInt(this.getCss(a,"height")));var e=a.offsetWidth;return"undefined"==typeof a.offsetWidth&&(e=parseInt(this.getCss(a,"width"))),{top:b,left:c,width:e,height:d}},e[c].mouse=function(a){var c=0,d=0;return a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+b.body.scrollLeft+b.documentElement.scrollLeft,d=a.clientY+b.body.scrollTop+b.documentElement.scrollTop),{x:c,y:d}},e[c].bind=function(a,c,d){var e="onwheel"in b.createElement("div")?"wheel":void 0!==b.onmousewheel?"mousewheel":"DOMMouseScroll",f=this;a.addEventListener?"mousewheel"===c?a.addEventListener(e,function(a){d.call(f,a,this)},!1):a.addEventListener(c,function(a){d.call(f,a,this)},!1):a.attachEvent?a.attachEvent("on"+c,function(a){d.call(f,a,this)}):a["on"+c]=function(a){d.call(f,a,this)}},e[c].unbind=function(a,c,d){var e="onwheel"in b.createElement("div")?"wheel":void 0!==b.onmousewheel?"mousewheel":"DOMMouseScroll";a.addEventListener?"mousewheel"===c?a.removeEventListener(e,function(a){d.call(_this,a,this)},!1):a.removeEventListener(c,function(a){d.call(_this,a,this)},!1):a.attachEvent?a.detachEvent("on"+c,function(a){d.call(_this,a,this)}):a["on"+c]=null},e[c].stopEvent=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1},a.Miniscroll=e}(window,document,"prototype");
